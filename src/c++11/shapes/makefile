######################################################################
# makefile
#
# This makefile assumes that the build environment is already correctly
# configured. (For example, the correct version of your compiler and
# linker should be on the PATH.)
#
# Author: Rajive Joshi, Real-Time Innovations Inc. Copyright (C) 2017.
######################################################################

# Check NDDSHOME:
ifndef NDDSHOME
$(error Please define NDDSHOME)
endif
$(info NDDSHOME=${NDDSHOME})

# Include autogenerated makefile (if any) to build for the desired target
include $(wildcard makefile_ShapeType_*)

SOURCES += $(SOURCE_DIR)Service.cxx $(SOURCE_DIR)Component.cxx \
		  $(SOURCE_DIR)Service_publisher.cxx \
		  $(SOURCE_DIR)Service_subscriber.cxx
	
EXEC   += Component_square_pub_sub \
		  Component_square_pub Component_circle_pub_triangle_pub \
		  Component_square_sub_circle_sub Component_triangle_sub 

$(TARGET_ARCH) : $(DIRECTORIES) $(COMMONOBJS) \
	$(EXEC:%=objs/$(TARGET_ARCH)/%.o) \
	$(EXEC:%=objs/$(TARGET_ARCH)/%)
				    
# Generate C++ type handling code from IDL datatypes:
ShapeTypePlugin.cxx ShapeType.cxx \
ShapeTypePlugin.hpp ShapeType.hpp : \
  ../../../res/types/ShapeType.idl
	$(NDDSHOME)/bin/rtiddsgen ../../../res/types/ShapeType.idl -d . \
				-ppDisable -update typefiles \
				-language C++11 -stl 

# Generate a platform specific makefile
# Example:
#   		make makefile/x64Darwin16clang8.0
makefile/%: ../../../res/types/ShapeType.idl
	rtiddsgen ../../../res/types/ShapeType.idl -ppDisable -d . \
				-language C++11 -stl \
				-update makefiles -platform $*
	@echo 
	@echo "!!ACTION REQUIRED!!"
	@echo "In generated makefile, please comment out the line:"
	@echo "    #  EXEC = "

			   
clean:
	rm -rf objs/
	rm ShapeTypePlugin.cxx ShapeType.cxx \
	   ShapeTypePlugin.hpp ShapeType.hpp
